


<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html id="htmlId">
<head>
  <title>Coverage Report :: UmCarroJa</title>
  <style type="text/css">
    @import "../../.css/coverage.css";
  </style>
</head>

<body>
<div class="header"></div>

<div class="content">
<div class="breadCrumbs">
    [ <a href="../../index.html">all classes</a> ]
    [ <a href="../index.html">main.java</a> ]
</div>

<h1>Coverage Summary for Class: UmCarroJa (main.java)</h1>

<table class="coverageStats">
<tr>
  <th class="name">Class</th>
<th class="coverageStat 
">
  Class, %
</th>
<th class="coverageStat 
">
  Method, %
</th>
<th class="coverageStat 
">
  Line, %
</th>
</tr>
<tr>
  <td class="name">UmCarroJa</td>
<td class="coverageStat">
  <span class="percent">
    100%
  </span>
  <span class="absValue">
    (1/ 1)
  </span>
</td>
<td class="coverageStat">
  <span class="percent">
    96.4%
  </span>
  <span class="absValue">
    (53/ 55)
  </span>
</td>
<td class="coverageStat">
  <span class="percent">
    56.4%
  </span>
  <span class="absValue">
    (211/ 374)
  </span>
</td>
</tr>

</table>

<br/>
<br/>


<div class="sourceCode"><i>1</i>&nbsp;/**
<i>2</i>&nbsp; * Esta classe contém todas as estruturas de dados da aplicação.
<i>3</i>&nbsp; * Foi usado HashMap para guardar os actores da aplicação (clientes e proprietários)
<i>4</i>&nbsp; * onde a chave de acesso a esta é o seu email.
<i>5</i>&nbsp; * 
<i>6</i>&nbsp; * 
<i>7</i>&nbsp; * 
<i>8</i>&nbsp; * 
<i>9</i>&nbsp; * @version 20190415
<i>10</i>&nbsp; */
<i>11</i>&nbsp;
<i>12</i>&nbsp;package main.java;
<i>13</i>&nbsp;
<i>14</i>&nbsp;import java.io.Serializable;
<i>15</i>&nbsp;import java.util.*;
<i>16</i>&nbsp;import java.util.stream.Collectors;
<i>17</i>&nbsp;
<i>18</i>&nbsp;import java.io.IOException;
<i>19</i>&nbsp;import java.io.FileOutputStream;
<i>20</i>&nbsp;import java.io.ObjectOutputStream;
<i>21</i>&nbsp;
<i>22</i>&nbsp;import static java.lang.System.*;
<i>23</i>&nbsp;
<i>24</i>&nbsp;public class UmCarroJa implements Serializable {
<i>25</i>&nbsp;    
<i>26</i>&nbsp;    /** Variáveis de Instância */
<i>27</i>&nbsp;    
<i>28</i>&nbsp;    /* Map cuja chave de acesso é o email do user e o valor é o próprio */
<i>29</i>&nbsp;    private Map&lt;String, Utilizador&gt; utilizadores;
<i>30</i>&nbsp;    
<i>31</i>&nbsp;    /* Map cuja chave de acesso é a matrícula do veículo e o valor é o próprio veículo */
<i>32</i>&nbsp;    private Map&lt;String, Veiculo&gt; veiculos;
<i>33</i>&nbsp;    
<i>34</i>&nbsp;    /* Map cuja chave de acesso é o nif do proprietário e o valor é outro map contendo como chave de acesso
<i>35</i>&nbsp;       a matrícula / id da viatura, e como valor armazenado uma lista com os alugueres */
<i>36</i>&nbsp;    private Map&lt;String, Map&lt;String, List&lt;Aluguer&gt;&gt;&gt; alugueres;
<i>37</i>&nbsp;    
<i>38</i>&nbsp;    /* Utilizador que efetuou o login */
<i>39</i>&nbsp;    private Utilizador user;
<i>40</i>&nbsp;
<i>41</i>&nbsp;    private GregorianCalendar dataInicioApp;
<i>42</i>&nbsp;
<b class="fc"><i>43</i>&nbsp;    private String errorAlugar = &quot;Não Existem Veículos Disponíveis para Alugar.&quot;;</b>
<i>44</i>&nbsp;    
<i>45</i>&nbsp;    /**********************************************************************************
<i>46</i>&nbsp;     *                                  CONSTRUTORES                                  *
<i>47</i>&nbsp;     **********************************************************************************/
<i>48</i>&nbsp;
<i>49</i>&nbsp;    /**
<i>50</i>&nbsp;     * Construtor por omissão.
<i>51</i>&nbsp;     * É criada uma instância da classe UmCarroJa.
<i>52</i>&nbsp;     */
<b class="fc"><i>53</i>&nbsp;    public UmCarroJa(){</b>
<b class="fc"><i>54</i>&nbsp;        this.utilizadores = new HashMap&lt;&gt;();</b>
<b class="fc"><i>55</i>&nbsp;        this.veiculos = new HashMap&lt;&gt;();</b>
<b class="fc"><i>56</i>&nbsp;        this.alugueres = new HashMap&lt;&gt;();</b>
<b class="fc"><i>57</i>&nbsp;        this.user = new Utilizador();</b>
<b class="fc"><i>58</i>&nbsp;        this.dataInicioApp = new GregorianCalendar();</b>
<b class="fc"><i>59</i>&nbsp;    }</b>
<i>60</i>&nbsp;    
<i>61</i>&nbsp;    /**********************************************************************************
<i>62</i>&nbsp;     *                              END CONSTRUTORES                                  *
<i>63</i>&nbsp;     **********************************************************************************/
<i>64</i>&nbsp;
<i>65</i>&nbsp;
<i>66</i>&nbsp;    /**********************************************************************************
<i>67</i>&nbsp;     *                              MÉTODOS DO UTILIZADOR                             *
<i>68</i>&nbsp;     **********************************************************************************/
<i>69</i>&nbsp;    
<i>70</i>&nbsp;    /**
<i>71</i>&nbsp;     * Método que devolve o utilizador referente ao email recebido como parâmetro.
<i>72</i>&nbsp;     * @param email Email do utilizador que se pretende obter.
<i>73</i>&nbsp;     * @return Utilizador Devolve o utilizador correspondente ao email recebido como parâmetro, caso este exista.
<i>74</i>&nbsp;     */
<i>75</i>&nbsp;    public Utilizador getUtilizador(String email) throws UtilizadorNaoExisteException {
<b class="fc"><i>76</i>&nbsp;        if (!(this.utilizadores.containsKey(email))){</b>
<b class="fc"><i>77</i>&nbsp;            throw new UtilizadorNaoExisteException(email);</b>
<i>78</i>&nbsp;        }
<b class="fc"><i>79</i>&nbsp;        return utilizadores.get(email).clone();</b>
<i>80</i>&nbsp;    }
<i>81</i>&nbsp;
<i>82</i>&nbsp;    /**
<i>83</i>&nbsp;     * Método que devolve o NIF do utilizador que está logado.
<i>84</i>&nbsp;     * @return String Devolve NIF do utilizador que tem sessão iniciada.
<i>85</i>&nbsp;     */
<i>86</i>&nbsp;    public String getUserNIF(){
<b class="fc"><i>87</i>&nbsp;        return this.user.getNIF();</b>
<i>88</i>&nbsp;    }
<i>89</i>&nbsp;
<i>90</i>&nbsp;    /**
<i>91</i>&nbsp;     * Método que devolve o Email do utilizador que está logado.
<i>92</i>&nbsp;     * @return String Devolve Email do utilizador que tem sessão iniciada.
<i>93</i>&nbsp;     */
<i>94</i>&nbsp;    public String getEmailUser(){
<b class="fc"><i>95</i>&nbsp;        return  this.user.getEmail();</b>
<i>96</i>&nbsp;    }
<i>97</i>&nbsp;
<i>98</i>&nbsp;    /**
<i>99</i>&nbsp;     * Método que devolve a posição do utilizador que está logado (Cliente).
<i>100</i>&nbsp;     * @return Coordinate Devolve a posição do utilizador que tem sessão iniciada.
<i>101</i>&nbsp;     */
<i>102</i>&nbsp;    public Coordinate getPosicaoCliente(){
<b class="fc"><i>103</i>&nbsp;        Cliente c = (Cliente) this.user;</b>
<b class="fc"><i>104</i>&nbsp;        return c.getPosicao();</b>
<i>105</i>&nbsp;    }
<i>106</i>&nbsp;
<i>107</i>&nbsp;    public GregorianCalendar getDataInicioApp() {
<b class="fc"><i>108</i>&nbsp;        return dataInicioApp;</b>
<i>109</i>&nbsp;    }
<i>110</i>&nbsp;
<i>111</i>&nbsp;    public void setDataInicioApp(GregorianCalendar date){
<b class="fc"><i>112</i>&nbsp;        this.dataInicioApp = date;</b>
<b class="fc"><i>113</i>&nbsp;    }</b>
<i>114</i>&nbsp;
<i>115</i>&nbsp;    /**
<i>116</i>&nbsp;     * Método responsável por registar um utilizador no Map de utilizadores. Primeiro é feita uma
<i>117</i>&nbsp;     * verificação se o mesmo já existe no Map de utilizadores, caso exista é enviada
<i>118</i>&nbsp;     * uma exception. Caso contrário o mesmo é inserido no Map de utilizadores.
<i>119</i>&nbsp;     *  
<i>120</i>&nbsp;     * @param user Utilizador que se pretende registar.
<i>121</i>&nbsp;     */
<i>122</i>&nbsp;    public void registarUtilizador(Utilizador user) throws UtilizadorJaExisteException{
<b class="fc"><i>123</i>&nbsp;        if (this.utilizadores.containsKey(user.getEmail())) {</b>
<b class="fc"><i>124</i>&nbsp;            throw new UtilizadorJaExisteException(user.getEmail());</b>
<i>125</i>&nbsp;        }
<b class="fc"><i>126</i>&nbsp;        this.utilizadores.put(user.getEmail(), user.clone());</b>
<b class="fc"><i>127</i>&nbsp;    }</b>
<i>128</i>&nbsp;    
<i>129</i>&nbsp;    /**
<i>130</i>&nbsp;     * Método responsável por iniciar sessão do utilizador. É feita primeiro uma verificação para
<i>131</i>&nbsp;     * comprovar que este existe no Map de Utilizadores, através do email recebido como parâmetro,
<i>132</i>&nbsp;     * caso este existe é então comparada a sua password com a recebida como parâmetro.
<i>133</i>&nbsp;     * 
<i>134</i>&nbsp;     * @param email    Email do utilizador que pretende iniciar sessão.
<i>135</i>&nbsp;     * @param password Password do utilizador que pretende iniciar sessão.
<i>136</i>&nbsp;     */
<i>137</i>&nbsp;    public void iniciarSessao(String email, String password) throws UtilizadorNaoExisteException, PasswordIncorretaException  {
<b class="fc"><i>138</i>&nbsp;        if (!(this.utilizadores.containsKey(email))){</b>
<b class="fc"><i>139</i>&nbsp;            throw new UtilizadorNaoExisteException(email);</b>
<i>140</i>&nbsp;        }
<b class="fc"><i>141</i>&nbsp;        if (!(this.utilizadores.get(email).getPassword().equals(password))){</b>
<b class="fc"><i>142</i>&nbsp;            throw new PasswordIncorretaException(password);</b>
<i>143</i>&nbsp;        }
<b class="fc"><i>144</i>&nbsp;        this.user = utilizadores.get(email).clone();</b>
<b class="fc"><i>145</i>&nbsp;    }</b>
<i>146</i>&nbsp;    
<i>147</i>&nbsp;    /**
<i>148</i>&nbsp;     * Método responsável por fazer logout do utilizador, colocando o user a null.
<i>149</i>&nbsp;     */
<i>150</i>&nbsp;    public void logoutUtilizador() {
<b class="fc"><i>151</i>&nbsp;        this.user = null;</b>
<b class="fc"><i>152</i>&nbsp;    }</b>
<i>153</i>&nbsp;    
<i>154</i>&nbsp;    /**
<i>155</i>&nbsp;     * @param email Email do utilizador a verificar se existe no Map.
<i>156</i>&nbsp;     * @return Devolve true se existir um utilizador com o email recebido como parâmetro no Map de utilizadores 
<i>157</i>&nbsp;     *         ou false caso contrário.
<i>158</i>&nbsp;     */
<i>159</i>&nbsp;    public boolean existeUtilizador(String email) {
<b class="fc"><i>160</i>&nbsp;        return this.utilizadores.containsKey(email);</b>
<i>161</i>&nbsp;    }
<i>162</i>&nbsp;
<i>163</i>&nbsp;    /**********************************************************************************
<i>164</i>&nbsp;     *                          FIM DOS MÉTODOS DO UTILIZADOR                         *
<i>165</i>&nbsp;     **********************************************************************************/
<i>166</i>&nbsp;
<i>167</i>&nbsp;
<i>168</i>&nbsp;    /**********************************************************************************
<i>169</i>&nbsp;     *                            MÉTODOS DA ADMINISTRAÇÃO                            *
<i>170</i>&nbsp;     **********************************************************************************/
<i>171</i>&nbsp;
<i>172</i>&nbsp;    /**
<i>173</i>&nbsp;     * Método responsável por determinar a lista de alugueres de uma viatura.
<i>174</i>&nbsp;     * @throws VeiculoNaoExisteException Exceção caso não seja o proprietário do veículo.
<i>175</i>&nbsp;     * @param matricula  Matricula.
<i>176</i>&nbsp;     * @return List&lt;Aluguer&gt; Lista de alugueres de um veículos.
<i>177</i>&nbsp;     */
<i>178</i>&nbsp;    public List&lt;Aluguer&gt; getAlugueresVeiculo(String matricula)  throws VeiculoNaoExisteException{
<b class="fc"><i>179</i>&nbsp;        if(!this.veiculos.containsKey(matricula)) {</b>
<b class="fc"><i>180</i>&nbsp;            throw new VeiculoNaoExisteException(matricula);</b>
<i>181</i>&nbsp;        }
<b class="nc"><i>182</i>&nbsp;        Veiculo v = this.veiculos.get(matricula);</b>
<b class="nc"><i>183</i>&nbsp;        String prop = v.getNIF();</b>
<b class="nc"><i>184</i>&nbsp;        List&lt;Aluguer&gt; aux = this.alugueres.get(prop).get(matricula);</b>
<i>185</i>&nbsp;
<b class="nc"><i>186</i>&nbsp;        if(aux != null){</b>
<b class="nc"><i>187</i>&nbsp;            return aux.stream().map(Aluguer:: clone).collect(Collectors.toList());</b>
<i>188</i>&nbsp;        }
<b class="nc"><i>189</i>&nbsp;        return aux;</b>
<i>190</i>&nbsp;    }
<i>191</i>&nbsp;
<i>192</i>&nbsp;    /**
<i>193</i>&nbsp;     * Método que devolve uma lista dos 10 clientes que têm mais KM percorridos da aplicação.
<i>194</i>&nbsp;     * @throws NaoExistemClientesException Exceção caso não existam clientes.
<i>195</i>&nbsp;     * @return List&lt;Cliente&gt; Lista dos 10 clientes com mais Km percorridos.
<i>196</i>&nbsp;     */
<i>197</i>&nbsp;    public List&lt;Cliente&gt; get10ClientesKm() throws NaoExistemClientesException{
<b class="fc"><i>198</i>&nbsp;        List&lt;Cliente&gt; cli = new ArrayList&lt;&gt;();</b>
<b class="fc"><i>199</i>&nbsp;        for(Utilizador u: this.utilizadores.values()){</b>
<b class="fc"><i>200</i>&nbsp;            if(u instanceof Cliente){</b>
<b class="fc"><i>201</i>&nbsp;                Cliente c = (Cliente) u;</b>
<b class="fc"><i>202</i>&nbsp;                cli.add(c.clone());</b>
<i>203</i>&nbsp;            }
<b class="fc"><i>204</i>&nbsp;        }</b>
<b class="fc"><i>205</i>&nbsp;        if(cli.isEmpty()){</b>
<b class="fc"><i>206</i>&nbsp;            throw new NaoExistemClientesException(&quot;Não existem clientes a apresentar.&quot;);</b>
<i>207</i>&nbsp;        }
<b class="fc"><i>208</i>&nbsp;        cli.sort(new ComparadorKm());</b>
<b class="fc"><i>209</i>&nbsp;        return cli.stream().limit(10).collect(Collectors.toList());</b>
<i>210</i>&nbsp;    }
<i>211</i>&nbsp;
<i>212</i>&nbsp;    /**
<i>213</i>&nbsp;     * Método que devolve uma lista dos 10 clientes que têm mais alugueres efetuados na aplicação.
<i>214</i>&nbsp;     * @throws NaoExistemClientesException Exceção caso não existam clientes.
<i>215</i>&nbsp;     * @return List&lt;Cliente&gt; Lista dos 10 clientes com mais alugueres efetuados.
<i>216</i>&nbsp;     */
<i>217</i>&nbsp;    public List&lt;Cliente&gt; get10ClientesAlugueres() throws NaoExistemClientesException{
<b class="fc"><i>218</i>&nbsp;        List&lt;Cliente&gt; cli = new ArrayList&lt;&gt;();</b>
<b class="fc"><i>219</i>&nbsp;        for(Utilizador u: this.utilizadores.values()){</b>
<b class="fc"><i>220</i>&nbsp;            if(u instanceof Cliente){</b>
<b class="fc"><i>221</i>&nbsp;                Cliente c = (Cliente) u;</b>
<b class="fc"><i>222</i>&nbsp;                cli.add(c.clone());</b>
<i>223</i>&nbsp;            }
<b class="fc"><i>224</i>&nbsp;        }</b>
<b class="fc"><i>225</i>&nbsp;        if(cli.isEmpty()){</b>
<b class="fc"><i>226</i>&nbsp;            throw new NaoExistemClientesException(&quot;Não existem clientes a apresentar.&quot;);</b>
<i>227</i>&nbsp;        }
<b class="fc"><i>228</i>&nbsp;        cli.sort(new ComparadorNAluguer());</b>
<b class="fc"><i>229</i>&nbsp;        return cli.stream().limit(10).collect(Collectors.toList());</b>
<i>230</i>&nbsp;    }
<i>231</i>&nbsp;
<i>232</i>&nbsp;    /**********************************************************************************
<i>233</i>&nbsp;     *                        FIM DOS MÉTODOS DA ADMINISTRAÇÃO                        *
<i>234</i>&nbsp;     **********************************************************************************/
<i>235</i>&nbsp;
<i>236</i>&nbsp;
<i>237</i>&nbsp;    /**********************************************************************************
<i>238</i>&nbsp;     *                            MÉTODOS PROPRIETÁRIOS                               *
<i>239</i>&nbsp;     **********************************************************************************/
<i>240</i>&nbsp;
<i>241</i>&nbsp;    /**
<i>242</i>&nbsp;     * Método que verifica se existe um determinado veículo existe na aplicação.
<i>243</i>&nbsp;     * @param matricula Matrícula do veículo a verificar se existe no Map.
<i>244</i>&nbsp;     * @return Devolve true se existir um veículo com a matrícula recebida como parâmetro no Map de veículos
<i>245</i>&nbsp;     *         ou false caso contrário.
<i>246</i>&nbsp;     */
<i>247</i>&nbsp;    public boolean existeVeiculo(String matricula) {
<b class="fc"><i>248</i>&nbsp;        return this.veiculos.containsKey(matricula);</b>
<i>249</i>&nbsp;    }
<i>250</i>&nbsp;
<i>251</i>&nbsp;
<i>252</i>&nbsp;    /* -------------------------------- CLASSIFICAÇÃO -------------------------------- */
<i>253</i>&nbsp;
<i>254</i>&nbsp;
<i>255</i>&nbsp;    /**
<i>256</i>&nbsp;     * Método responsável por devolver uma lista de alugueres que o proprietário tem para classificar o cliente.
<i>257</i>&nbsp;     * É feito um varrimento completo e feita a verificação acerca do estado da classificação.
<i>258</i>&nbsp;     *
<i>259</i>&nbsp;     * @return List&lt;Aluguer&gt; Lista com os alugueres para o proprietário classificar o cliente.
<i>260</i>&nbsp;     */
<i>261</i>&nbsp;     public List&lt;Aluguer&gt; alugueresClassificarCliente() throws NaoExistemAlugueresException{
<b class="fc"><i>262</i>&nbsp;         List&lt;Aluguer&gt; alugsClassif = new ArrayList&lt;&gt;();</b>
<i>263</i>&nbsp;
<b class="fc"><i>264</i>&nbsp;         if (!this.alugueres.containsKey(getUserNIF())){</b>
<b class="fc"><i>265</i>&nbsp;             throw new NaoExistemAlugueresException(getUserNIF());</b>
<i>266</i>&nbsp;         }
<i>267</i>&nbsp;
<b class="nc"><i>268</i>&nbsp;         Map&lt;String, List&lt;Aluguer&gt;&gt; alugsProp = this.alugueres.get(getUserNIF());</b>
<i>269</i>&nbsp;
<b class="nc"><i>270</i>&nbsp;         for (List&lt;Aluguer&gt; lAlugs : alugsProp.values()){</b>
<b class="nc"><i>271</i>&nbsp;             for (Aluguer alug : lAlugs){</b>
<b class="nc"><i>272</i>&nbsp;                 if (alug.getRealizado() &amp;&amp; (alug.getEstadoClassificacao() == 0 || alug.getEstadoClassificacao() == 2)){</b>
<b class="nc"><i>273</i>&nbsp;                     alugsClassif.add(alug);</b>
<i>274</i>&nbsp;                 }
<b class="nc"><i>275</i>&nbsp;             }</b>
<b class="nc"><i>276</i>&nbsp;         }</b>
<b class="nc"><i>277</i>&nbsp;         return alugsClassif;</b>
<i>278</i>&nbsp;     }
<i>279</i>&nbsp;
<i>280</i>&nbsp;    /**
<i>281</i>&nbsp;     * Método responsável por efetuar a classificação do cliente.
<i>282</i>&nbsp;     * Vai-se buscar a classificação anterior e faz-se média com o número de alugueres que
<i>283</i>&nbsp;     * o cliente tem e depois é substituido nos alugueres.
<i>284</i>&nbsp;     * @param alug           Aluguer a classificar o cliente.
<i>285</i>&nbsp;     * @param classif        Classificação a atribuir.
<i>286</i>&nbsp;     */
<i>287</i>&nbsp;     public void classificarCliente(Aluguer alug, int classif){
<b class="fc"><i>288</i>&nbsp;         Cliente cli = (Cliente) this.utilizadores.get(alug.getEmail());</b>
<b class="fc"><i>289</i>&nbsp;         int nAlugs = cli.getNAlugueres();</b>
<b class="fc"><i>290</i>&nbsp;         int classificAnterior = cli.getClassificacao();</b>
<b class="fc"><i>291</i>&nbsp;         double novaClassificacao = (double)(classificAnterior + classif) / (nAlugs);</b>
<b class="fc"><i>292</i>&nbsp;         Long c = Math.round(novaClassificacao);</b>
<b class="fc"><i>293</i>&nbsp;         int classifiFinal = c.intValue();</b>
<b class="fc"><i>294</i>&nbsp;         cli.setClassificacao(classifiFinal);</b>
<b class="fc"><i>295</i>&nbsp;         this.utilizadores.replace(cli.getEmail(), cli.clone());</b>
<b class="fc"><i>296</i>&nbsp;         if (alug.getEstadoClassificacao() == 0){</b>
<b class="fc"><i>297</i>&nbsp;             alug.setEstadoClassificacao(1);</b>
<i>298</i>&nbsp;         }
<b class="fc"><i>299</i>&nbsp;         if (alug.getEstadoClassificacao() == 2){</b>
<b class="nc"><i>300</i>&nbsp;             alug.setEstadoClassificacao(3);</b>
<i>301</i>&nbsp;         }
<b class="fc"><i>302</i>&nbsp;     }</b>
<i>303</i>&nbsp;
<i>304</i>&nbsp;
<i>305</i>&nbsp;    /* ----------------------------------- VEÍCULOS ---------------------------------- */
<i>306</i>&nbsp;
<i>307</i>&nbsp;
<i>308</i>&nbsp;    /**
<i>309</i>&nbsp;     * Método responsável por registar um veículo. É feita primeiro 
<i>310</i>&nbsp;     * uma verificação para comprovar que este existe no Map de veiculos, através da matrícula 
<i>311</i>&nbsp;     * recebida como parâmetro, caso este exista não é adicionado caso contrário o veículo é adicionado ao map de veiculos.
<i>312</i>&nbsp;     * 
<i>313</i>&nbsp;     * @param v Veículo a registar.
<i>314</i>&nbsp;     */
<i>315</i>&nbsp;    public void registarVeiculo(Veiculo v) throws VeiculoJaExisteException{
<b class="fc"><i>316</i>&nbsp;        String matricula = v.getMatricula();</b>
<b class="fc"><i>317</i>&nbsp;        if(this.veiculos.containsKey(matricula)){</b>
<b class="fc"><i>318</i>&nbsp;            throw new VeiculoJaExisteException(matricula);</b>
<i>319</i>&nbsp;        }
<b class="fc"><i>320</i>&nbsp;        this.veiculos.put(matricula, v.clone());</b>
<b class="fc"><i>321</i>&nbsp;    }</b>
<i>322</i>&nbsp;    
<i>323</i>&nbsp;    /**
<i>324</i>&nbsp;     * Método responsável por definir a disponibilidade de um certo veículo. É feita primeiro 
<i>325</i>&nbsp;     * uma verificação para comprovar que este existe no Map de veiculos, através da matrícula 
<i>326</i>&nbsp;     * recebida como parâmetro, caso este exista é alterada a disponibilidade recebendo esta também com parâmetro.
<i>327</i>&nbsp;     * 
<i>328</i>&nbsp;     * @param matricula        Matrícula do veículo.
<i>329</i>&nbsp;     * @param disponibilidade  Disponibilidade desejada para o veículo.
<i>330</i>&nbsp;     */
<i>331</i>&nbsp;    public void sinalizarDisponibilidade(String matricula, boolean disponibilidade) throws VeiculoNaoExisteException, VeiculoNaoESeuException{
<b class="fc"><i>332</i>&nbsp;        if(!veiculos.containsKey(matricula)){</b>
<b class="fc"><i>333</i>&nbsp;            throw new VeiculoNaoExisteException(matricula);</b>
<i>334</i>&nbsp;        }
<b class="fc"><i>335</i>&nbsp;        if(!this.user.getNIF().equals((veiculos.get(matricula).getNIF()))) {</b>
<b class="nc"><i>336</i>&nbsp;            throw new VeiculoNaoESeuException(matricula);</b>
<i>337</i>&nbsp;        }
<b class="fc"><i>338</i>&nbsp;        this.veiculos.get(matricula).setDisponibilidade(disponibilidade);</b>
<b class="fc"><i>339</i>&nbsp;    }</b>
<i>340</i>&nbsp;    
<i>341</i>&nbsp;    /**
<i>342</i>&nbsp;     * Método responsável por abastecer um certo veículo. 
<i>343</i>&nbsp;     * 
<i>344</i>&nbsp;     * @param matricula    Matrícula do veículo a abastecer.
<i>345</i>&nbsp;     * @param quantidade    Quantidade a abastecer.
<i>346</i>&nbsp;     */
<i>347</i>&nbsp;    public void abastecerVeiculo(String matricula, double quantidade) throws VeiculoNaoExisteException, VeiculoNaoESeuException{
<b class="fc"><i>348</i>&nbsp;        if(!this.veiculos.containsKey(matricula)){</b>
<b class="fc"><i>349</i>&nbsp;            throw new VeiculoNaoExisteException(matricula);</b>
<i>350</i>&nbsp;        }
<b class="nc"><i>351</i>&nbsp;        if(!this.user.getNIF().equals((veiculos.get(matricula).getNIF()))) {</b>
<b class="nc"><i>352</i>&nbsp;            throw new VeiculoNaoESeuException(matricula);</b>
<i>353</i>&nbsp;        }
<b class="nc"><i>354</i>&nbsp;        this.veiculos.get(matricula).abastecerVeiculo(quantidade);</b>
<b class="nc"><i>355</i>&nbsp;    }</b>
<i>356</i>&nbsp;    
<i>357</i>&nbsp;    /**
<i>358</i>&nbsp;     * Método responsável por alterar preço por Km de um veículo.
<i>359</i>&nbsp;     * 
<i>360</i>&nbsp;     * @param matricula Matrícula do veículo.
<i>361</i>&nbsp;     * @param precoKM   Novo Preço por KM.
<i>362</i>&nbsp;     */
<i>363</i>&nbsp;    public void altPrecoKm(String matricula, double precoKM) throws VeiculoNaoExisteException, VeiculoNaoESeuException{
<b class="fc"><i>364</i>&nbsp;        if(!veiculos.containsKey(matricula)){</b>
<b class="fc"><i>365</i>&nbsp;            throw new VeiculoNaoExisteException(matricula);</b>
<i>366</i>&nbsp;        }
<b class="fc"><i>367</i>&nbsp;        if(!this.user.getNIF().equals((veiculos.get(matricula).getNIF()))) {</b>
<b class="fc"><i>368</i>&nbsp;            throw new VeiculoNaoESeuException(matricula);</b>
<i>369</i>&nbsp;        }
<b class="fc"><i>370</i>&nbsp;        veiculos.get(matricula).setPreco(precoKM);</b>
<b class="fc"><i>371</i>&nbsp;    }</b>
<i>372</i>&nbsp;
<i>373</i>&nbsp;
<i>374</i>&nbsp;    /* ---------------------------------- ALUGUERES ---------------------------------- */
<i>375</i>&nbsp;
<i>376</i>&nbsp;
<i>377</i>&nbsp;    /**
<i>378</i>&nbsp;     * Método responsável por determinar a lista de alugueres de um proprietário.
<i>379</i>&nbsp;     * 
<i>380</i>&nbsp;     * @param chave  Chave de acesso do proprietário.
<i>381</i>&nbsp;     */
<i>382</i>&nbsp;    public List&lt;Aluguer&gt; getAlugueresProp(String chave){
<b class="fc"><i>383</i>&nbsp;        List&lt;Aluguer&gt; res = new ArrayList&lt;&gt;();</b>
<b class="fc"><i>384</i>&nbsp;        Map&lt;String, List&lt;Aluguer&gt;&gt; aux = this.alugueres.get(chave);</b>
<i>385</i>&nbsp;        
<b class="fc"><i>386</i>&nbsp;        if(aux != null){</b>
<b class="nc"><i>387</i>&nbsp;            for (List&lt;Aluguer&gt; a : aux.values()) {</b>
<b class="nc"><i>388</i>&nbsp;                for(Aluguer al : a) {</b>
<b class="nc"><i>389</i>&nbsp;                    res.add(al.clone());</b>
<b class="nc"><i>390</i>&nbsp;                }</b>
<b class="nc"><i>391</i>&nbsp;            }</b>
<i>392</i>&nbsp;            }
<b class="fc"><i>393</i>&nbsp;        return res;</b>
<i>394</i>&nbsp;    }
<i>395</i>&nbsp;    
<i>396</i>&nbsp;    /**
<i>397</i>&nbsp;     * Método responsável por determinar a lista de alugueres de um proprietário 
<i>398</i>&nbsp;     * que estão à espera de uma resposta do mesmo.
<i>399</i>&nbsp;     * 
<i>400</i>&nbsp;     * @param chave  Chave de acesso do proprietario.
<i>401</i>&nbsp;     */
<i>402</i>&nbsp;    public List&lt;Aluguer&gt; determinarListaEspera(String chave){
<b class="fc"><i>403</i>&nbsp;        List&lt;Aluguer&gt; alugs = getAlugueresProp(chave);</b>
<b class="fc"><i>404</i>&nbsp;        alugs.stream().filter(Aluguer::getListaEspera).collect(Collectors.toList());</b>
<b class="fc"><i>405</i>&nbsp;        return alugs;</b>
<i>406</i>&nbsp;    }
<i>407</i>&nbsp;    
<i>408</i>&nbsp;    /**
<i>409</i>&nbsp;     * Método responsável por definir no aluguer se este foi aceite pelo proprietário.
<i>410</i>&nbsp;     * 
<i>411</i>&nbsp;     * @param resp  Resposta do proprietário ao pedido de aluguer.
<i>412</i>&nbsp;     * @param alug  Aluguer ao qual recebeu resposta do proprietário.
<i>413</i>&nbsp;     */
<i>414</i>&nbsp;    public void respostaProp(boolean resp, Aluguer alug){
<i>415</i>&nbsp;        // buscar indice do aluguer na lista de alugueres do veiculo em questão
<b class="fc"><i>416</i>&nbsp;        int index = this.alugueres.get(user.getNIF()).get(alug.getMatricula()).indexOf(alug);</b>
<i>417</i>&nbsp;        // remover antigo aluguer que está desatualizado
<b class="nc"><i>418</i>&nbsp;        this.alugueres.get(user.getNIF()).get(alug.getMatricula()).remove(index);</b>
<i>419</i>&nbsp;        
<b class="nc"><i>420</i>&nbsp;        alug.setListaEspera(false);</b>
<b class="nc"><i>421</i>&nbsp;        alug.setAceite(resp);</b>
<i>422</i>&nbsp;        
<b class="nc"><i>423</i>&nbsp;        if(resp) {</b>
<b class="nc"><i>424</i>&nbsp;            GregorianCalendar inicio = alug.getDataInicio();</b>
<b class="nc"><i>425</i>&nbsp;            GregorianCalendar fim = alug.getDataInicio();</b>
<b class="nc"><i>426</i>&nbsp;            this.veiculos.get(alug.getMatricula()).addDatas(inicio,fim);</b>
<i>427</i>&nbsp;        }
<i>428</i>&nbsp;        
<i>429</i>&nbsp;        //adicionar alugueres na posição correta
<b class="nc"><i>430</i>&nbsp;        this.alugueres.get(user.getNIF()).get(alug.getMatricula()).add(index,alug);</b>
<b class="nc"><i>431</i>&nbsp;    }</b>
<i>432</i>&nbsp;    
<i>433</i>&nbsp;    /**
<i>434</i>&nbsp;     * Método responsável por determinar a lista de alugueres de um proprietário feitos por determinado cliente e veiculo 
<i>435</i>&nbsp;     * que estão à espera de uma resposta do mesmo.
<i>436</i>&nbsp;     * 
<i>437</i>&nbsp;     * @param matricula  Matricula Carro.
<i>438</i>&nbsp;     * @param mail  Email do Cliente.
<i>439</i>&nbsp;     */
<i>440</i>&nbsp;    public List&lt;Aluguer&gt; determinarListaAlugCli(String matricula, String mail) throws VeiculoNaoESeuException, UtilizadorNaoExisteException{
<b class="fc"><i>441</i>&nbsp;        if(!this.utilizadores.containsKey(mail)) {</b>
<b class="fc"><i>442</i>&nbsp;            throw new UtilizadorNaoExisteException(mail);</b>
<i>443</i>&nbsp;        }
<b class="fc"><i>444</i>&nbsp;        if(!this.user.getNIF().equals((veiculos.get(matricula).getNIF()))) {</b>
<b class="nc"><i>445</i>&nbsp;            throw new VeiculoNaoESeuException(matricula);</b>
<i>446</i>&nbsp;        }
<b class="nc"><i>447</i>&nbsp;        List&lt;Aluguer&gt; alugs = this.alugueres.get(user.getNIF()).get(matricula).stream().map(Aluguer :: clone).collect(Collectors.toList());</b>
<b class="nc"><i>448</i>&nbsp;        alugs.stream().filter(alug -&gt; !alug.getAlteraPreco() &amp;&amp; alug.getEmail().equals(mail)).collect(Collectors.toList());</b>
<b class="nc"><i>449</i>&nbsp;        return alugs;</b>
<i>450</i>&nbsp;    }
<i>451</i>&nbsp;    
<i>452</i>&nbsp;    /**
<i>453</i>&nbsp;     * Método responsável por alterar o preço de um aluguer.
<i>454</i>&nbsp;     * 
<i>455</i>&nbsp;     * @param newPrice novo preço.
<i>456</i>&nbsp;     * @param alug  Aluguer ao qual o seu preço vai ser alterado.
<i>457</i>&nbsp;     */
<i>458</i>&nbsp;    public void altPrecoAluguer(double newPrice, Aluguer alug){
<i>459</i>&nbsp;        // buscar indice do aluguer na lista de alugueres do veiculo em questão
<b class="fc"><i>460</i>&nbsp;        int index = this.alugueres.get(user.getNIF()).get(alug.getMatricula()).indexOf(alug);</b>
<i>461</i>&nbsp;        // remover antigo aluguer que está desatualizado
<b class="nc"><i>462</i>&nbsp;        this.alugueres.get(user.getNIF()).get(alug.getMatricula()).remove(index);</b>
<i>463</i>&nbsp;        
<b class="nc"><i>464</i>&nbsp;        alug.setAlteraPreco(true);</b>
<b class="nc"><i>465</i>&nbsp;        alug.setCustoViagem(newPrice);</b>
<i>466</i>&nbsp;         
<i>467</i>&nbsp;        //adicionar alugueres na posição correta
<b class="nc"><i>468</i>&nbsp;        this.alugueres.get(user.getNIF()).get(alug.getMatricula()).add(index,alug);</b>
<b class="nc"><i>469</i>&nbsp;    }</b>
<i>470</i>&nbsp;    
<i>471</i>&nbsp;    /**
<i>472</i>&nbsp;     * Método responsável por determinar o total faturado de um veículo entre duas datas, 
<i>473</i>&nbsp;     * recebidas como parâmetro.
<i>474</i>&nbsp;     * 
<i>475</i>&nbsp;     * @param matricula  Matrícula do veículo.
<i>476</i>&nbsp;     * @param inicio     Limite temporal inferior.
<i>477</i>&nbsp;     * @param fim        Limite temporal superior.
<i>478</i>&nbsp;     */
<i>479</i>&nbsp;    public double totalFactBDates(String matricula, GregorianCalendar inicio, GregorianCalendar fim) throws VeiculoNaoESeuException{
<b class="fc"><i>480</i>&nbsp;        double total = 0;</b>
<b class="fc"><i>481</i>&nbsp;        if(! this.alugueres.get(user.getNIF()).containsKey(matricula)){</b>
<b class="nc"><i>482</i>&nbsp;            throw new VeiculoNaoESeuException(matricula);</b>
<i>483</i>&nbsp;        }
<b class="nc"><i>484</i>&nbsp;        for(Aluguer a: this.alugueres.get(user.getNIF()).get(matricula)){</b>
<b class="nc"><i>485</i>&nbsp;            if(a.getDataInicio().after(inicio) &amp;&amp; a.getDataFim().before(fim) &amp;&amp; a.getAceite()){</b>
<b class="nc"><i>486</i>&nbsp;                total += a.getCustoViagem();</b>
<i>487</i>&nbsp;            }
<b class="nc"><i>488</i>&nbsp;        }</b>
<b class="nc"><i>489</i>&nbsp;        return total;</b>
<i>490</i>&nbsp;    }
<i>491</i>&nbsp;
<i>492</i>&nbsp;    /**********************************************************************************
<i>493</i>&nbsp;     *                           FIM MÉTODOS PROPRIETÁRIOS                            *
<i>494</i>&nbsp;     **********************************************************************************/
<i>495</i>&nbsp;
<i>496</i>&nbsp;     
<i>497</i>&nbsp;    /**********************************************************************************
<i>498</i>&nbsp;     *                                MÉTODOS CLIENTES                                *
<i>499</i>&nbsp;     **********************************************************************************/
<i>500</i>&nbsp;
<i>501</i>&nbsp;
<i>502</i>&nbsp;    /* -------------------------------- CLASSIFICAÇÃO -------------------------------- */
<i>503</i>&nbsp;
<i>504</i>&nbsp;
<i>505</i>&nbsp;    /**
<i>506</i>&nbsp;     * Método responsável por devolver uma lista de alugueres que o cliente tem para classificar o veículo.
<i>507</i>&nbsp;     * É feito um varrimento completo e feita a verificação acerca do estado da classificação.
<i>508</i>&nbsp;     *
<i>509</i>&nbsp;     * @return List&lt;Aluguer&gt; Lista com os alugueres para o cliente classificar o veículo.
<i>510</i>&nbsp;     */
<i>511</i>&nbsp;    public List&lt;Aluguer&gt; alugueresClassificarVeiculo(){
<b class="fc"><i>512</i>&nbsp;        List&lt;Aluguer&gt; alugsClassif = new ArrayList&lt;&gt;();</b>
<b class="fc"><i>513</i>&nbsp;        for (Map&lt;String, List&lt;Aluguer&gt;&gt; mAlugs : this.alugueres.values()){</b>
<b class="nc"><i>514</i>&nbsp;            for (List&lt;Aluguer&gt; lAlugs : mAlugs.values()){</b>
<b class="nc"><i>515</i>&nbsp;                for (Aluguer alug : lAlugs){</b>
<b class="nc"><i>516</i>&nbsp;                    if (alug.getEmail().equals(getEmailUser()) &amp;&amp; alug.getRealizado()</b>
<b class="nc"><i>517</i>&nbsp;                            &amp;&amp; (alug.getEstadoClassificacao() == 0 || alug.getEstadoClassificacao() == 1)){</b>
<b class="nc"><i>518</i>&nbsp;                        alugsClassif.add(alug);</b>
<i>519</i>&nbsp;                    }
<b class="nc"><i>520</i>&nbsp;                }</b>
<b class="nc"><i>521</i>&nbsp;            }</b>
<b class="nc"><i>522</i>&nbsp;        }</b>
<b class="fc"><i>523</i>&nbsp;        return  alugsClassif;</b>
<i>524</i>&nbsp;    }
<i>525</i>&nbsp;
<i>526</i>&nbsp;    /**
<i>527</i>&nbsp;     * Método responsável por efetuar a classificação do veículo.
<i>528</i>&nbsp;     * Vai-se buscar a classificação anterior e faz-se média com o número de alugueres que
<i>529</i>&nbsp;     * o cliente tem e depois é substituido nos alugueres.
<i>530</i>&nbsp;     * @param alug           Aluguer a classificar o cliente.
<i>531</i>&nbsp;     * @param classif        Classificação a atribuir.
<i>532</i>&nbsp;     */
<i>533</i>&nbsp;    public void classificarVeiculo(Aluguer alug, int classif){
<b class="fc"><i>534</i>&nbsp;        Veiculo v = this.veiculos.get(alug.getMatricula());</b>
<b class="fc"><i>535</i>&nbsp;        int nAlugs = this.veiculos.get(alug.getMatricula()).getDatasAlugueres().size();</b>
<b class="fc"><i>536</i>&nbsp;        int classificAnterior = v.getClassificacao();</b>
<b class="fc"><i>537</i>&nbsp;        double novaClassificacao = (double)(classificAnterior + classif) / nAlugs;</b>
<b class="fc"><i>538</i>&nbsp;        Long c = Math.round(novaClassificacao);</b>
<b class="fc"><i>539</i>&nbsp;        int classifiFinal = c.intValue();</b>
<b class="fc"><i>540</i>&nbsp;        v.setClassificacao(classifiFinal);</b>
<b class="fc"><i>541</i>&nbsp;        this.veiculos.replace(v.getMatricula(), v.clone());</b>
<b class="fc"><i>542</i>&nbsp;        if (alug.getEstadoClassificacao() == 0){</b>
<b class="fc"><i>543</i>&nbsp;            alug.setEstadoClassificacao(2);</b>
<i>544</i>&nbsp;        }
<b class="fc"><i>545</i>&nbsp;        if (alug.getEstadoClassificacao() == 1){</b>
<b class="nc"><i>546</i>&nbsp;            alug.setEstadoClassificacao(3);</b>
<i>547</i>&nbsp;        }
<b class="fc"><i>548</i>&nbsp;    }</b>
<i>549</i>&nbsp;
<i>550</i>&nbsp;
<i>551</i>&nbsp;    /* ---------------------------------- ALUGUERES ---------------------------------- */
<i>552</i>&nbsp;
<i>553</i>&nbsp;
<i>554</i>&nbsp;    /**
<i>555</i>&nbsp;     * Método responsável por registar um aluguer na aplicação. É feita a inserção a partir
<i>556</i>&nbsp;     * do NIF do proprietário e no segundo Map, a inserção é através da matrícula do veículo
<i>557</i>&nbsp;     * do proprietário e este aluguer será adicionado a este lista. Caso o proprietário ainda
<i>558</i>&nbsp;     * não tenha qualquer aluguer registado é feita então a criação das estruturas de dados
<i>559</i>&nbsp;     * para armazenar o aluguer.
<i>560</i>&nbsp;     *
<i>561</i>&nbsp;     * @param alug Aluguer que se pretende registar.
<i>562</i>&nbsp;     */
<i>563</i>&nbsp;    public void registaAluguer(Aluguer alug){
<b class="fc"><i>564</i>&nbsp;        String matricula = alug.getMatricula();</b>
<b class="fc"><i>565</i>&nbsp;        String nifProp = this.veiculos.get(matricula).getNIF();</b>
<i>566</i>&nbsp;
<b class="nc"><i>567</i>&nbsp;        Map&lt;String, List&lt;Aluguer&gt;&gt; alugs = this.alugueres.get(nifProp);</b>
<i>568</i>&nbsp;        try{
<b class="nc"><i>569</i>&nbsp;            if (alugs.get(matricula) == null){</b>
<b class="nc"><i>570</i>&nbsp;                List&lt;Aluguer&gt; alugsPropVeiculo = new ArrayList&lt;&gt;();</b>
<b class="nc"><i>571</i>&nbsp;                alugsPropVeiculo.add(alug.clone());</b>
<b class="nc"><i>572</i>&nbsp;                alugs.put(matricula, alugsPropVeiculo);</b>
<b class="nc"><i>573</i>&nbsp;            }else{</b>
<b class="nc"><i>574</i>&nbsp;                List&lt;Aluguer&gt; alugsPropVeiculo = alugs.get(matricula);</b>
<b class="nc"><i>575</i>&nbsp;                alugsPropVeiculo.add(alug.clone());</b>
<b class="nc"><i>576</i>&nbsp;                alugs.put(matricula, alugsPropVeiculo);</b>
<i>577</i>&nbsp;            }
<i>578</i>&nbsp;        }
<b class="nc"><i>579</i>&nbsp;        catch (NullPointerException exc){</b>
<b class="nc"><i>580</i>&nbsp;            alugs = new HashMap&lt;&gt;();</b>
<b class="nc"><i>581</i>&nbsp;            List&lt;Aluguer&gt; alugsPropVeiculo = new ArrayList&lt;&gt;();</b>
<b class="nc"><i>582</i>&nbsp;            alugsPropVeiculo.add(alug.clone());</b>
<b class="nc"><i>583</i>&nbsp;            alugs.put(matricula, alugsPropVeiculo);</b>
<b class="nc"><i>584</i>&nbsp;        }</b>
<b class="nc"><i>585</i>&nbsp;        this.alugueres.put(nifProp, alugs);</b>
<b class="nc"><i>586</i>&nbsp;    }</b>
<i>587</i>&nbsp;
<i>588</i>&nbsp;    /**
<i>589</i>&nbsp;     * Método que coloca os alugueres efetuados antes de uma determinada data, recebida como parâmetro a
<i>590</i>&nbsp;     * realizados ou não realizados, dependendo se a data recebida como parâmetro é depois ou antes da data
<i>591</i>&nbsp;     * de fim de aluguer.
<i>592</i>&nbsp;     */
<i>593</i>&nbsp;    public void alugueresEfetuados(){
<b class="fc"><i>594</i>&nbsp;        for (Map&lt;String, List&lt;Aluguer&gt;&gt; mAlugs : this.alugueres.values()){</b>
<b class="nc"><i>595</i>&nbsp;            for (List&lt;Aluguer&gt; lAlugs : mAlugs.values()){</b>
<b class="nc"><i>596</i>&nbsp;                for (Aluguer alug : lAlugs){</b>
<b class="nc"><i>597</i>&nbsp;                    if (alug.getDataFim().before(this.dataInicioApp) &amp;&amp; !alug.getRealizado()){</b>
<b class="nc"><i>598</i>&nbsp;                        alug.setRealizado(true);</b>
<b class="nc"><i>599</i>&nbsp;                        String matricula = alug.getMatricula();</b>
<b class="nc"><i>600</i>&nbsp;                        String mail = alug.getEmail();</b>
<b class="nc"><i>601</i>&nbsp;                        Cliente cli = (Cliente) this.utilizadores.get(mail);</b>
<b class="nc"><i>602</i>&nbsp;                        cli.setNAlugueres(cli.getNAlugueres() + 1);</b>
<b class="nc"><i>603</i>&nbsp;                        cli.setNKM(alug.getDistancia() + cli.getNKm());</b>
<b class="nc"><i>604</i>&nbsp;                        cli.setPosicao(alug.getDestino());</b>
<b class="nc"><i>605</i>&nbsp;                        Veiculo v = this.veiculos.get(matricula);</b>
<b class="nc"><i>606</i>&nbsp;                        v.setPosicao(alug.getDestino());</b>
<b class="nc"><i>607</i>&nbsp;                        Long d = Math.round(alug.getDistancia());</b>
<b class="nc"><i>608</i>&nbsp;                        int dist = d.intValue();</b>
<b class="nc"><i>609</i>&nbsp;                        v.setAutonomia(v.getAutonomia() - dist);</b>
<i>610</i>&nbsp;                    }
<b class="nc"><i>611</i>&nbsp;                }</b>
<b class="nc"><i>612</i>&nbsp;            }</b>
<b class="nc"><i>613</i>&nbsp;        }</b>
<b class="fc"><i>614</i>&nbsp;    }</b>
<i>615</i>&nbsp;
<i>616</i>&nbsp;    /**
<i>617</i>&nbsp;     * Método responsável por devolver uma lista com os veículos que estão disponíveis
<i>618</i>&nbsp;     * para alugar, numa determinada data recebida como parâmetro. É feita
<i>619</i>&nbsp;     * inicialmente uma verificação se este está disponível e depois são comparadas
<i>620</i>&nbsp;     * as datas de aluguer deste com a data de aluguer recebida com o parâmetro.
<i>621</i>&nbsp;     *
<i>622</i>&nbsp;     * @param date  Intervalo de datas em que o cliente pretende o aluguer.
<i>623</i>&nbsp;     */
<i>624</i>&nbsp;    private List&lt;Veiculo&gt; disponiveisAlugar(Coordinate destino, ParDatas date){
<b class="fc"><i>625</i>&nbsp;        return this.veiculos.values().stream().filter(v -&gt; v.getDisponibilidade() &amp;&amp;</b>
<b class="fc"><i>626</i>&nbsp;                v.getDatasAlugueres().stream().filter(d -&gt; !d.isAvailable(date)).count() == 0</b>
<b class="fc"><i>627</i>&nbsp;                &amp;&amp; autonomiaSuf(v,destino)).map(Veiculo :: clone).collect(Collectors.toList());</b>
<i>628</i>&nbsp;    }
<i>629</i>&nbsp;
<i>630</i>&nbsp;    /**
<i>631</i>&nbsp;     * Método responsável por determinar se um veículo tem autonomia suficiente
<i>632</i>&nbsp;     * para atingir um certo destino.
<i>633</i>&nbsp;     *
<i>634</i>&nbsp;     * @param v        Veículo a efetuar a verificação.
<i>635</i>&nbsp;     * @param destino  Destino do cliente.
<i>636</i>&nbsp;     * @return boolean True caso tenha autonomia, False caso contrário.
<i>637</i>&nbsp;     */
<i>638</i>&nbsp;    private boolean autonomiaSuf(Veiculo v, Coordinate destino){
<b class="fc"><i>639</i>&nbsp;        return (v.getAutonomia() &gt;= v.getPosicao().getDistancia(destino));</b>
<i>640</i>&nbsp;    }
<i>641</i>&nbsp;    
<i>642</i>&nbsp;    /**
<i>643</i>&nbsp;     * Método responsável por devolver uma List ordenada com os veículos mais
<i>644</i>&nbsp;     * próximos do cliente, que estejam disponíveis para aluguar mediante
<i>645</i>&nbsp;     * uma data recebida como parâmetro e mediante o destino.
<i>646</i>&nbsp;     *
<i>647</i>&nbsp;     * @param destino  Destino do cliente.
<i>648</i>&nbsp;     * @param date     Intervalo de datas em que o cliente pretende o aluguer.
<i>649</i>&nbsp;     * @param quantos  Número a listar.
<i>650</i>&nbsp;     */
<i>651</i>&nbsp;    public List&lt;Veiculo&gt; maisProximo(Coordinate destino, ParDatas date, int quantos) throws NaoExistemVeiculosDisponiveisException{
<b class="fc"><i>652</i>&nbsp;        List&lt;Veiculo&gt; veiculosOrdenados = new ArrayList&lt;&gt;();</b>
<i>653</i>&nbsp;
<i>654</i>&nbsp;
<b class="fc"><i>655</i>&nbsp;        for (Veiculo v : disponiveisAlugar(destino, date)){</b>
<b class="nc"><i>656</i>&nbsp;            veiculosOrdenados.add(v.clone());</b>
<b class="nc"><i>657</i>&nbsp;        }</b>
<b class="fc"><i>658</i>&nbsp;        if(veiculosOrdenados.isEmpty()){</b>
<b class="fc"><i>659</i>&nbsp;            throw new NaoExistemVeiculosDisponiveisException(errorAlugar);</b>
<i>660</i>&nbsp;        }
<b class="nc"><i>661</i>&nbsp;        Coordinate posCli = getPosicaoCliente();</b>
<b class="nc"><i>662</i>&nbsp;        veiculosOrdenados.sort((a1, a2) -&gt; {</b>
<b class="nc"><i>663</i>&nbsp;            if (a1.getPosicao().getDistancia(posCli) &lt; a2.getPosicao().getDistancia(posCli)) {</b>
<b class="nc"><i>664</i>&nbsp;                return 1;</b>
<i>665</i>&nbsp;            }
<b class="nc"><i>666</i>&nbsp;            return -1;</b>
<i>667</i>&nbsp;        });
<b class="nc"><i>668</i>&nbsp;        return veiculosOrdenados.stream().limit(quantos).collect(Collectors.toList());</b>
<i>669</i>&nbsp;    }
<i>670</i>&nbsp;    
<i>671</i>&nbsp;    /**
<i>672</i>&nbsp;     * Método responsável por devolver uma Lista ordenada com os veículos mais
<i>673</i>&nbsp;     * baratos, onde em cada veículo na lista de datas de aluguer do mesmo,
<i>674</i>&nbsp;     * esteja disponíveis para alugar mediante uma data recebida como parâmetro
<i>675</i>&nbsp;     * e caso tenha autonomia.
<i>676</i>&nbsp;     *
<i>677</i>&nbsp;     * @param destino Destino do cliente.
<i>678</i>&nbsp;     * @param date    Intervalo de datas em que o cliente pretende o aluguer.
<i>679</i>&nbsp;     * @param quantos Número de veículos que o cliente deseja ver.
<i>680</i>&nbsp;     * @throws NaoExistemVeiculosDisponiveisException Excepção caso não existam veículos disponíveis.
<i>681</i>&nbsp;     * @return List&lt;Veiculo&gt; Lista com os veículos mais baratos.
<i>682</i>&nbsp;     */
<i>683</i>&nbsp;    public List&lt;Veiculo&gt; maisBarato(Coordinate destino, ParDatas date, int quantos) throws NaoExistemVeiculosDisponiveisException{
<b class="fc"><i>684</i>&nbsp;        List&lt;Veiculo&gt; veic = new ArrayList&lt;&gt;();</b>
<i>685</i>&nbsp;
<b class="fc"><i>686</i>&nbsp;        for (Veiculo v : disponiveisAlugar(destino, date)){</b>
<b class="nc"><i>687</i>&nbsp;            veic.add(v.clone());</b>
<b class="nc"><i>688</i>&nbsp;        }</b>
<b class="fc"><i>689</i>&nbsp;        if(veic.isEmpty()){</b>
<b class="fc"><i>690</i>&nbsp;            throw new NaoExistemVeiculosDisponiveisException(errorAlugar);</b>
<i>691</i>&nbsp;        }
<b class="nc"><i>692</i>&nbsp;        veic.sort(new ComparadorPreco());</b>
<b class="nc"><i>693</i>&nbsp;        return veic.stream().limit(quantos).collect(Collectors.toList());</b>
<i>694</i>&nbsp;    }
<i>695</i>&nbsp;    
<i>696</i>&nbsp;    /**
<i>697</i>&nbsp;     * Método responsável por devolver uma Lista ordenada com os veículos mais baratos que estão disponíveis
<i>698</i>&nbsp;     * para alugar, numa determinada data recebida como parâmetro e dentro de um perímetro. É feita
<i>699</i>&nbsp;     * inicialmente uma verificação se este está disponível, depois são comparadas
<i>700</i>&nbsp;     * as datas de aluguer deste com a data de aluguer recebida com o parâmetro e posteriormente
<i>701</i>&nbsp;     * calculada a distancia entre o Cliente e o Veiculo e são apresentados os veiculos cuja
<i>702</i>&nbsp;     * distância é menor ou igual ao perímetro.
<i>703</i>&nbsp;     *
<i>704</i>&nbsp;     * @param destino   Destino do cliente.
<i>705</i>&nbsp;     * @param cordsCli  Coordenadas do cliente.
<i>706</i>&nbsp;     * @param date      Intervalo de datas em que o cliente pretende o aluguer.
<i>707</i>&nbsp;     * @param perimetro Perimetro a percorrer a pé pelo cliente.
<i>708</i>&nbsp;     * @param quantos   Número de veículos que o cliente deseja ver.
<i>709</i>&nbsp;     * @throws NaoExistemVeiculosDisponiveisException Excepção caso não existam veículos disponíveis.
<i>710</i>&nbsp;     * @return List&lt;Veiculo&gt; Lista com os veículos mais baratos num perímetro.
<i>711</i>&nbsp;     */
<i>712</i>&nbsp;    public List&lt;Veiculo&gt; maisBaratoNoPerimetro (Coordinate destino, Coordinate cordsCli, ParDatas date, double perimetro, int quantos) throws NaoExistemVeiculosDisponiveisException{
<b class="fc"><i>713</i>&nbsp;        List&lt;Veiculo&gt; veiculosOrdenados = maisBarato(destino,date,quantos);</b>
<b class="nc"><i>714</i>&nbsp;        List&lt;Veiculo&gt; veiculosBaratosNoP = new ArrayList&lt;&gt;();</b>
<i>715</i>&nbsp;
<b class="nc"><i>716</i>&nbsp;        for(Veiculo v: veiculosOrdenados){</b>
<b class="nc"><i>717</i>&nbsp;            if (cordsCli.getDistancia(v.getPosicao()) &lt;= perimetro){</b>
<b class="nc"><i>718</i>&nbsp;                veiculosBaratosNoP.add(v.clone());</b>
<i>719</i>&nbsp;            }
<b class="nc"><i>720</i>&nbsp;        }</b>
<b class="nc"><i>721</i>&nbsp;        if(veiculosBaratosNoP.isEmpty()){</b>
<b class="nc"><i>722</i>&nbsp;            throw new NaoExistemVeiculosDisponiveisException(errorAlugar);</b>
<i>723</i>&nbsp;        }
<b class="nc"><i>724</i>&nbsp;        return veiculosBaratosNoP.stream().limit(quantos).collect(Collectors.toList());</b>
<i>725</i>&nbsp;    }
<i>726</i>&nbsp;
<i>727</i>&nbsp;    /**
<i>728</i>&nbsp;     * Método responsável por devolver o Veiculo em especifico requisitado pelo cliente.
<i>729</i>&nbsp;     * Caso o veiculo não exista , devolve VeiculoNaoExisteException.
<i>730</i>&nbsp;     * Visto que é relativo a um veiculo apenas, obtemos as datas de alugueres do veiculo e
<i>731</i>&nbsp;     * verificamos a disponibilidade das datas e do veiculo.
<i>732</i>&nbsp;     *
<i>733</i>&nbsp;     * @param destino Destino do cliente.
<i>734</i>&nbsp;     * @param date    Intervalo de datas em que o cliente pretende o aluguer.
<i>735</i>&nbsp;     * @param id      Matrícula do veículo.
<i>736</i>&nbsp;     * @throws VeiculoNaoExisteException Excepção caso o veículo não exista.
<i>737</i>&nbsp;     * @throws VeiculoIndisponivelException Excepção caso o veículo esteja indisponivel para alugar.
<i>738</i>&nbsp;     * @return Veiculo O veículo a alugar.
<i>739</i>&nbsp;     */
<i>740</i>&nbsp;    public Veiculo veiculoEspecifico(Coordinate destino, ParDatas date, String id) throws VeiculoNaoExisteException, VeiculoIndisponivelException{
<b class="fc"><i>741</i>&nbsp;        if( !this.veiculos.containsKey(id) ){</b>
<b class="fc"><i>742</i>&nbsp;            throw new VeiculoNaoExisteException(id);</b>
<i>743</i>&nbsp;        }
<i>744</i>&nbsp;
<b class="nc"><i>745</i>&nbsp;        List&lt;ParDatas&gt; datasDeUmVeiculo = this.veiculos.get(id).getDatasAlugueres();</b>
<i>746</i>&nbsp;
<b class="nc"><i>747</i>&nbsp;        if(this.veiculos.get(id).getDisponibilidade() &amp;&amp; autonomiaSuf(this.veiculos.get(id), destino) &amp;&amp;</b>
<b class="nc"><i>748</i>&nbsp;                datasDeUmVeiculo.stream().filter(d-&gt; !d.isAvailable(date)).count() == 0){</b>
<b class="nc"><i>749</i>&nbsp;            return this.veiculos.get(id).clone();</b>
<i>750</i>&nbsp;        }else {
<b class="nc"><i>751</i>&nbsp;            throw new VeiculoIndisponivelException(id);</b>
<i>752</i>&nbsp;        }
<i>753</i>&nbsp;    }
<i>754</i>&nbsp;  
<i>755</i>&nbsp;    /**
<i>756</i>&nbsp;     * Método responsável por devolver uma Lista com os veículos com autonomia dentro de um intervalo,
<i>757</i>&nbsp;     * que estão disponíveis para alugar, numa determinada data recebida como parâmetro.
<i>758</i>&nbsp;     *
<i>759</i>&nbsp;     * @param destino  Destino do cliente.
<i>760</i>&nbsp;     * @param date     Intervalo de datas em que o cliente pretende o aluguer.
<i>761</i>&nbsp;     * @param val1     Limite inferior do intervalo
<i>762</i>&nbsp;     * @param val2     Limite superior do intervalo
<i>763</i>&nbsp;     * @param quantos  Número de veículos a listar.
<i>764</i>&nbsp;     * @throws NaoExistemVeiculosDisponiveisException Excepção caso não existam veículos disponíveis para alugar.
<i>765</i>&nbsp;     * @return List&lt;Veiculo&gt; Lista ordenada com os veículos que têm a autonomia desejada.
<i>766</i>&nbsp;     */
<i>767</i>&nbsp;    public List&lt;Veiculo&gt; determinadaAutonomia (Coordinate destino, ParDatas date, int val1, int val2, int quantos) throws NaoExistemVeiculosDisponiveisException {
<b class="fc"><i>768</i>&nbsp;        List&lt;Veiculo&gt; veiculosAuto = new ArrayList&lt;&gt;();</b>
<i>769</i>&nbsp;
<b class="fc"><i>770</i>&nbsp;        for(Veiculo v: disponiveisAlugar(destino,date) ){</b>
<b class="nc"><i>771</i>&nbsp;            if(v.verificaAutonomia(val1,val2)){</b>
<b class="nc"><i>772</i>&nbsp;                veiculosAuto.add(v.clone());</b>
<i>773</i>&nbsp;            }
<b class="nc"><i>774</i>&nbsp;        }</b>
<b class="fc"><i>775</i>&nbsp;        if(veiculosAuto.isEmpty()){</b>
<b class="fc"><i>776</i>&nbsp;            throw new NaoExistemVeiculosDisponiveisException(errorAlugar);</b>
<i>777</i>&nbsp;        }
<b class="nc"><i>778</i>&nbsp;        veiculosAuto.sort(new ComparadorAutonomia());</b>
<b class="nc"><i>779</i>&nbsp;        return veiculosAuto.stream().limit(quantos).collect(Collectors.toList());</b>
<i>780</i>&nbsp;    }
<i>781</i>&nbsp;    
<i>782</i>&nbsp;   /**
<i>783</i>&nbsp;    * Método responsável por determinar a lista de alugueres de um cliente.
<i>784</i>&nbsp;    * 
<i>785</i>&nbsp;    * @param mail  Chave de acesso do cliente.
<i>786</i>&nbsp;    */
<i>787</i>&nbsp;   public List&lt;Aluguer&gt; getAlugueresCliente(String mail) throws NaoEfetuouNenhumAluguerException {
<b class="fc"><i>788</i>&nbsp;       List &lt;Aluguer&gt; lista = new ArrayList&lt;&gt;();</b>
<b class="fc"><i>789</i>&nbsp;       if(this.alugueres != null){</b>
<b class="fc"><i>790</i>&nbsp;           for(Map&lt;String, List&lt;Aluguer&gt;&gt; aux : this.alugueres.values()) {</b>
<b class="nc"><i>791</i>&nbsp;               if(aux != null) {</b>
<b class="nc"><i>792</i>&nbsp;                   lista.addAll(checkAlugueres(mail, aux));</b>
<i>793</i>&nbsp;               }
<b class="nc"><i>794</i>&nbsp;           }</b>
<i>795</i>&nbsp;       }
<b class="fc"><i>796</i>&nbsp;       if(lista.isEmpty()){</b>
<b class="fc"><i>797</i>&nbsp;           throw new NaoEfetuouNenhumAluguerException(&quot;Não efetuou nenhum aluguer.&quot;);</b>
<i>798</i>&nbsp;       }
<b class="nc"><i>799</i>&nbsp;       return lista;</b>
<i>800</i>&nbsp;   }
<i>801</i>&nbsp;
<i>802</i>&nbsp;    private List&lt;Aluguer&gt; checkAlugueres(String mail, Map&lt;String, List&lt;Aluguer&gt;&gt; aux) {
<b class="nc"><i>803</i>&nbsp;        List&lt;Aluguer&gt; l = new ArrayList&lt;&gt;();</b>
<b class="nc"><i>804</i>&nbsp;        for (List&lt;Aluguer&gt; a : aux.values()) {</b>
<b class="nc"><i>805</i>&nbsp;            for(Aluguer al : a) {</b>
<b class="nc"><i>806</i>&nbsp;                if(al.getEmail().equals(mail)){</b>
<b class="nc"><i>807</i>&nbsp;                    l.add(al.clone());</b>
<i>808</i>&nbsp;                }
<b class="nc"><i>809</i>&nbsp;            }</b>
<b class="nc"><i>810</i>&nbsp;        }</b>
<b class="nc"><i>811</i>&nbsp;        return l;</b>
<i>812</i>&nbsp;    }
<i>813</i>&nbsp;
<i>814</i>&nbsp;    
<i>815</i>&nbsp;   /**********************************************************************************
<i>816</i>&nbsp;    *                                FIM CLIENTES                                    *
<i>817</i>&nbsp;    **********************************************************************************/
<i>818</i>&nbsp;
<i>819</i>&nbsp;
<i>820</i>&nbsp;    /**********************************************************************************
<i>821</i>&nbsp;     *                        MÉTODOS EXCLUSIVOS PARA OS LOGS                         *
<i>822</i>&nbsp;     **********************************************************************************/
<i>823</i>&nbsp;
<i>824</i>&nbsp;    /**
<i>825</i>&nbsp;     * Método responsável por devolver o veículo mais próximo do cliente, q
<i>826</i>&nbsp;     * ue esteja disponível para aluguar mediante uma data recebida como
<i>827</i>&nbsp;     * parâmetro e mediante o destino.
<i>828</i>&nbsp;     *
<i>829</i>&nbsp;     * @param destino  Destino do cliente.
<i>830</i>&nbsp;     * @param date     Intervalo de datas em que o cliente pretende o aluguer.
<i>831</i>&nbsp;     * @param combustivel Tipo de combustível.
<i>832</i>&nbsp;     */
<i>833</i>&nbsp;    public Veiculo maisPertoJa(Coordinate destino, ParDatas date, String combustivel) throws NaoExistemVeiculosDisponiveisException{
<b class="fc"><i>834</i>&nbsp;        List&lt;Veiculo&gt; veiculosOrdenados = new ArrayList&lt;&gt;();</b>
<i>835</i>&nbsp;
<b class="fc"><i>836</i>&nbsp;        for (Veiculo v : disponiveisAlugar(destino, date)){</b>
<b class="nc"><i>837</i>&nbsp;            if (v.getClass().getSimpleName().equals(combustivel)) {</b>
<b class="nc"><i>838</i>&nbsp;                veiculosOrdenados.add(v.clone());</b>
<i>839</i>&nbsp;            }
<b class="nc"><i>840</i>&nbsp;        }</b>
<b class="fc"><i>841</i>&nbsp;        if(veiculosOrdenados.isEmpty()){</b>
<b class="fc"><i>842</i>&nbsp;            throw new NaoExistemVeiculosDisponiveisException(errorAlugar);</b>
<i>843</i>&nbsp;        }
<b class="nc"><i>844</i>&nbsp;        return veiculosOrdenados.get(0).clone();</b>
<i>845</i>&nbsp;    }
<i>846</i>&nbsp;
<i>847</i>&nbsp;    /**
<i>848</i>&nbsp;     * Método responsável por o veículo mais barato, que esteja disponível para alugar
<i>849</i>&nbsp;     * mediante uma data recebida como parâmetro e mediante uma coordenada de destino.
<i>850</i>&nbsp;     *
<i>851</i>&nbsp;     * @param dest  Coordenada do destino.
<i>852</i>&nbsp;     * @param date  Intervalo de datas em que o cliente pretende o aluguer.
<i>853</i>&nbsp;     * @param combustivel Tipo de combustível.
<i>854</i>&nbsp;     * @return Veiculo Veículo mais barato.
<i>855</i>&nbsp;     */
<i>856</i>&nbsp;    public Veiculo maisBaratoJa(Coordinate dest, ParDatas date, String combustivel) throws NaoExistemVeiculosDisponiveisException{
<b class="fc"><i>857</i>&nbsp;        List&lt;Veiculo&gt; veiculosOrdenados = new ArrayList&lt;&gt;();</b>
<i>858</i>&nbsp;
<b class="fc"><i>859</i>&nbsp;        for (Veiculo v : disponiveisAlugar(dest, date)){</b>
<b class="fc"><i>860</i>&nbsp;            if (v.getClass().getSimpleName().equals(combustivel)){</b>
<b class="nc"><i>861</i>&nbsp;                veiculosOrdenados.add(v);</b>
<i>862</i>&nbsp;            }
<b class="fc"><i>863</i>&nbsp;        }</b>
<b class="fc"><i>864</i>&nbsp;        if(veiculosOrdenados.isEmpty()){</b>
<b class="fc"><i>865</i>&nbsp;            throw new NaoExistemVeiculosDisponiveisException(errorAlugar);</b>
<i>866</i>&nbsp;        }
<b class="nc"><i>867</i>&nbsp;        return veiculosOrdenados.get(0).clone();</b>
<i>868</i>&nbsp;    }
<i>869</i>&nbsp;
<i>870</i>&nbsp;    public void alterarPosAutonomiaVeiculo(String matricula, Coordinate dest){
<b class="fc"><i>871</i>&nbsp;        Veiculo v = this.veiculos.get(matricula);</b>
<b class="fc"><i>872</i>&nbsp;        Long d = Math.round(v.getPosicao().getDistancia(dest));</b>
<b class="nc"><i>873</i>&nbsp;        int dist = d.intValue();</b>
<b class="nc"><i>874</i>&nbsp;        v.setAutonomia(v.getAutonomia() - dist);</b>
<b class="nc"><i>875</i>&nbsp;        v.setPosicao(dest);</b>
<b class="nc"><i>876</i>&nbsp;        GregorianCalendar dataInicio = new GregorianCalendar(2019,Calendar.MARCH,20);</b>
<b class="nc"><i>877</i>&nbsp;        GregorianCalendar dataFim = new GregorianCalendar(2019,Calendar.MARCH,21);</b>
<b class="nc"><i>878</i>&nbsp;        v.addDatas(dataInicio, dataFim);</b>
<b class="nc"><i>879</i>&nbsp;    }</b>
<i>880</i>&nbsp;
<i>881</i>&nbsp;    public void alterarPosCliente(String mail, Coordinate dest){
<b class="fc"><i>882</i>&nbsp;        Cliente cli = (Cliente) this.utilizadores.get(mail);</b>
<b class="fc"><i>883</i>&nbsp;        cli.setPosicao(dest);</b>
<b class="nc"><i>884</i>&nbsp;        cli.setNAlugueres(cli.getNAlugueres() + 1);</b>
<b class="nc"><i>885</i>&nbsp;    }</b>
<i>886</i>&nbsp;
<i>887</i>&nbsp;    public void classificarClienteJa(String mail, int classificacao){
<i>888</i>&nbsp;        try{
<b class="fc"><i>889</i>&nbsp;            Utilizador u = getUtilizador(mail);</b>
<b class="fc"><i>890</i>&nbsp;            if (u instanceof Cliente){</b>
<b class="fc"><i>891</i>&nbsp;                Cliente cli = (Cliente) u;</b>
<b class="fc"><i>892</i>&nbsp;                int nAlugs = cli.getNAlugueres();</b>
<b class="fc"><i>893</i>&nbsp;                if (nAlugs == 0){</b>
<b class="fc"><i>894</i>&nbsp;                    nAlugs = 1;</b>
<i>895</i>&nbsp;                }
<b class="fc"><i>896</i>&nbsp;                int classificAnterior = cli.getClassificacao();</b>
<b class="fc"><i>897</i>&nbsp;                double novaClassificacao = (double)(classificAnterior + classificacao) / nAlugs;</b>
<b class="fc"><i>898</i>&nbsp;                Long c = Math.round(novaClassificacao);</b>
<b class="fc"><i>899</i>&nbsp;                int classifiFinal = c.intValue();</b>
<b class="fc"><i>900</i>&nbsp;                cli.setClassificacao(classifiFinal);</b>
<b class="fc"><i>901</i>&nbsp;                this.utilizadores.replace(cli.getEmail(), cli.clone());</b>
<i>902</i>&nbsp;            }   
<b class="fc"><i>903</i>&nbsp;        }catch (UtilizadorNaoExisteException e){</b>
<b class="fc"><i>904</i>&nbsp;            out.println(e.getMessage());</b>
<b class="fc"><i>905</i>&nbsp;        }</b>
<b class="fc"><i>906</i>&nbsp;    }</b>
<i>907</i>&nbsp;
<i>908</i>&nbsp;    public void classificarVeiculoJa(String matricula, int classificacao){
<b class="fc"><i>909</i>&nbsp;        Veiculo v = this.veiculos.get(matricula);</b>
<b class="fc"><i>910</i>&nbsp;        int nAlugs = v.getDatasAlugueres().size();</b>
<b class="fc"><i>911</i>&nbsp;        if (nAlugs == 0){</b>
<b class="fc"><i>912</i>&nbsp;            nAlugs = 1;</b>
<i>913</i>&nbsp;        }
<b class="fc"><i>914</i>&nbsp;        int classificAnterior = v.getClassificacao();</b>
<b class="fc"><i>915</i>&nbsp;        double novaClassificacao = (double)(classificAnterior + classificacao) / nAlugs;</b>
<b class="fc"><i>916</i>&nbsp;        Long c = Math.round(novaClassificacao);</b>
<b class="fc"><i>917</i>&nbsp;        int classifiFinal = c.intValue();</b>
<b class="fc"><i>918</i>&nbsp;        v.setClassificacao(classifiFinal);</b>
<b class="fc"><i>919</i>&nbsp;        this.veiculos.replace(v.getMatricula(), v.clone());</b>
<b class="fc"><i>920</i>&nbsp;    }</b>
<i>921</i>&nbsp;
<i>922</i>&nbsp;    public int getNUsers(){
<b class="fc"><i>923</i>&nbsp;        return this.utilizadores.size();</b>
<i>924</i>&nbsp;    }
<i>925</i>&nbsp;    
<i>926</i>&nbsp;    public int getNVeiculos(){
<b class="fc"><i>927</i>&nbsp;        return this.veiculos.size();</b>
<i>928</i>&nbsp;    }
<i>929</i>&nbsp;    
<i>930</i>&nbsp;    public int getNAlugs(){
<b class="fc"><i>931</i>&nbsp;        int conta = 0;</b>
<b class="fc"><i>932</i>&nbsp;        for (Map&lt;String, List&lt;Aluguer&gt;&gt; a : this.alugueres.values()){</b>
<b class="nc"><i>933</i>&nbsp;            for (List&lt;Aluguer&gt; l : a.values()){</b>
<b class="nc"><i>934</i>&nbsp;                conta += l.size();</b>
<b class="nc"><i>935</i>&nbsp;            }</b>
<b class="nc"><i>936</i>&nbsp;        }</b>
<b class="fc"><i>937</i>&nbsp;        return conta;</b>
<i>938</i>&nbsp;    }
<i>939</i>&nbsp;    
<i>940</i>&nbsp;    public String toStringAlugs(){
<b class="fc"><i>941</i>&nbsp;        StringBuilder sb = new StringBuilder();</b>
<b class="fc"><i>942</i>&nbsp;        for (Map&lt;String, List&lt;Aluguer&gt;&gt; a : this.alugueres.values()){</b>
<b class="nc"><i>943</i>&nbsp;            for (List&lt;Aluguer&gt; l : a.values()){</b>
<b class="nc"><i>944</i>&nbsp;                for (Aluguer alug : l){</b>
<b class="nc"><i>945</i>&nbsp;                    sb.append(alug.toString());</b>
<b class="nc"><i>946</i>&nbsp;                    sb.append(&quot;\n&quot;);</b>
<b class="nc"><i>947</i>&nbsp;                }</b>
<b class="nc"><i>948</i>&nbsp;            }</b>
<b class="nc"><i>949</i>&nbsp;        }</b>
<b class="fc"><i>950</i>&nbsp;        return sb.toString();</b>
<i>951</i>&nbsp;    }
<i>952</i>&nbsp;    
<i>953</i>&nbsp;    public String toStringUser(){
<b class="fc"><i>954</i>&nbsp;        StringBuilder sb = new StringBuilder();</b>
<b class="fc"><i>955</i>&nbsp;        for (Utilizador a : this.utilizadores.values()){</b>
<b class="fc"><i>956</i>&nbsp;            sb.append(a.toString());</b>
<b class="fc"><i>957</i>&nbsp;            sb.append(&quot;\n&quot;);</b>
<b class="fc"><i>958</i>&nbsp;        }</b>
<b class="fc"><i>959</i>&nbsp;        return sb.toString();</b>
<i>960</i>&nbsp;    }
<i>961</i>&nbsp;    
<i>962</i>&nbsp;    public String toStringVeiculo(){
<b class="fc"><i>963</i>&nbsp;        StringBuilder sb = new StringBuilder();</b>
<b class="fc"><i>964</i>&nbsp;        for (Veiculo v : this.veiculos.values()){</b>
<b class="fc"><i>965</i>&nbsp;            sb.append(v.toString());</b>
<b class="fc"><i>966</i>&nbsp;            sb.append(&quot;\n&quot;);</b>
<b class="fc"><i>967</i>&nbsp;        }</b>
<b class="fc"><i>968</i>&nbsp;        return sb.toString();</b>
<i>969</i>&nbsp;    }
<i>970</i>&nbsp;
<i>971</i>&nbsp;    /**********************************************************************************
<i>972</i>&nbsp;     *                    FIM DOS MÉTODOS EXCLUSIVOS PARA OS LOGS                     *
<i>973</i>&nbsp;     **********************************************************************************/
<i>974</i>&nbsp;
<i>975</i>&nbsp;    /**
<i>976</i>&nbsp;     * Grava os campos da instância UmCarroJa e a data da aplicação num ficheiro objeto.
<i>977</i>&nbsp;     */
<i>978</i>&nbsp;    public void guardarEstado(String file, GregorianCalendar date) throws IOException{
<b class="fc"><i>979</i>&nbsp;        try (FileOutputStream fos = new FileOutputStream(file)) {</b>
<b class="fc"><i>980</i>&nbsp;            try (ObjectOutputStream oos = new ObjectOutputStream(fos)) {</b>
<b class="fc"><i>981</i>&nbsp;                oos.writeObject(date);</b>
<b class="fc"><i>982</i>&nbsp;                oos.writeObject(this);</b>
<b class="nc"><i>983</i>&nbsp;                oos.flush();</b>
<b class="fc"><i>984</i>&nbsp;            }</b>
<b class="fc"><i>985</i>&nbsp;        }</b>
<b class="nc"><i>986</i>&nbsp;    }</b>
<i>987</i>&nbsp;}
</div>
</div>

<div class="footer">
    
    <div style="float:right;">generated on 2020-01-14 19:02</div>
</div>
</body>
</html>
